<div class="user-dashboard">
  <h1>
    <%= user.username %>'s Dashboard
  </h1>

  <!-- User Details Box -->
  <div class="user-details-box">
    <h2>User Details</h2>
    <div class="user-info">
      <p><strong>Username:</strong>
        <%= user.username %>
      </p>
      <p><strong>Email:</strong>
        <%= user.email %>
      </p>
      <p><strong>Member since:</strong>
        <%= new Date(user.created_at).toLocaleDateString() %>
      </p>
    </div>
  </div>

  <!-- Stories Box -->
  <div class="stories-box">
    <h2>
      <%= user.id == session.userId ? 'My Stories' : `${user.username}'s Stories` %>
    </h2>
    <% if (user.id == session.userId) { %>
    <a href="../story/create" class="btn btn-create">
      <span class="btn-icon">✏️</span>
      Create New Story
    </a>
    <% } %>
    <% if (stories && stories.length> 0) { %>
    <div class="stories-list">
      <% stories.forEach(story=> { %>
      <div class="story-item">
        <h3>
          <a href="../story/<%= user.username %>/<%= story.vanity %>">
            <%= story.title %>
          </a>
        </h3>
        <% if (story.synopsis) { %>
        <p class="synopsis">
          <%= story.synopsis.substring(0, 150) %>
          <% if (story.synopsis.length> 150) { %>...<% } %>
        </p>
        <% } %>
        <div class="story-stats">
          <span class="chapters">Chapters: <%= story.chapter_count || 0 %></span>
          <% if (story.avg_rating) { %>
          <span class="rating">★ <%= Number(story.avg_rating).toFixed(1) %> (<%=
                                                    story.rating_count %> reviews)</span>
          <% } %>
          <% if (story.favorite_count> 0) { %>
          <span class="favorites">❤ <%= story.favorite_count %> favorites</span>
          <% } %>
        </div>
        <div class="story-dates">
          <span class="created">Created: <%= new Date(story.created_at).toLocaleDateString()
                                            %></span>
          <span class="updated">Updated: <%= new Date(story.updated_at).toLocaleDateString()
                                            %></span>
        </div>
      </div>
      <% }) %>
    </div>
    <% } else { %>
    <p class="no-content">This user hasn't created any stories yet.</p>
    <% } %>
  </div>

  <!-- Collections Box -->
  <div class="collections-box">
    <h2>
      <%= user.id == session.userId ? 'My Collections' : `${user.username}'s Collections` %>
    </h2>
    <% if (user.id == session.userId) { %>
    <a href="../collections/create" class="btn btn-create">
      <span class="btn-icon">✏️</span>
      Create New Collection
    </a>
    <% } %>

    <% if (collections && collections.length> 0) { %>
    <div class="collections-list">
      <% collections.forEach(collection=> { %>
      <div class="collection-item">
        <h3>
          <a href="../collections/<%= user.id %>/<%= collection.id %>">
            <%= collection.title %>
          </a>
        </h3>
        <% if (collection.description) { %>
        <p class="description">
          <%= collection.description.substring(0, 100) %>
          <% if (collection.description.length> 100) { %>...<% } %>
        </p>
        <% } %>
        <div class="collection-stats">
          <span class="story-count">Stories: <%= collection.story_count || 0 %></span>
          <span class="created">Created: <%= new
                                            Date(collection.created_at).toLocaleDateString() %></span>
        </div>
      </div>
      <% }) %>
    </div>
    <% } else { %>
    <p class="no-content">This user hasn't created any collections yet.</p>
    <% } %>
  </div>
</div>