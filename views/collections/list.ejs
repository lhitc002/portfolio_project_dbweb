<div class="collection-view">
  <div class="collection-header">
    <div class="header-top">
      <h2>
        <%= collection.title %>
      </h2>
      <% if (session.userId && session.userId == collection.user_id) { %>
      <div class="collection-actions">
        <a href="../collections/<%= userId %>/<%= collection.id %>/edit" class="btn btn-edit">
          <span class="btn-icon">‚úèÔ∏è</span>
          Edit
        </a>
        <form action="../collections/<%= userId %>/<%= collection.id %>/delete" method="POST" class="delete-form">
          <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure? This will permanently delete the collection.')">
            <span class="btn-icon">üóëÔ∏è</span>
            Delete
          </button>
        </form>
      </div>
      <% } %>
    </div>

    <% if (collection.description) { %>
    <p class="description">
      <%= collection.description %>
    </p>
    <% } %>

    <div class="collection-stats">
      <span class="story-count">Stories: <%= collection.story_count || 0 %></span>
      <span class="created">Created: <%= new Date(collection.created_at).toLocaleDateString() %></span>
      <% if (collection.updated_at) { %>
      <span class="updated">Updated: <%= new Date(collection.updated_at).toLocaleDateString() %></span>
      <% } %>
    </div>
    </header>

    <% if (stories.length > 0) { %>
    <div class="story-list">
      <% stories.forEach(story => { %>
      <div class="story-card">
        <a href="../story/<%= story.author_username %>/<%= story.story_vanity %>">
          <h3>
            <%= story.title %>
          </h3>
        </a>
        <p class="author">by <%= story.author_username %></p>
        <% if (story.synopsis) { %>
        <p class="synopsis">
          <%= story.synopsis.substring(0, 150) %>
          <% if (story.synopsis.length > 150) { %>...<% } %>
        </p>
        <% } %>
        <small>Posted on <%= new Date(story.created_at).toLocaleDateString() %></small>
      </div>
      <% }) %>
    </div>
    <% } else { %>
    <p class="empty-msg">No stories in this collection yet.</p>
    <% } %>

    <div class="back-link">
      <a href="../collections" class="button">‚Üê Back to Collections</a>
    </div>
  </div>