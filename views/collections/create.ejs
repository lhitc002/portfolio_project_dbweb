<div class="create-collection-container">
  <div class="create-collection-header">
    <h1>Create New Collection</h1>
    <p>Organize your favorite stories</p>
  </div>

  <% if (errors && errors.length > 0) { %>
  <div class="error-messages">
    <ul>
      <% errors.forEach(error => { %>
      <li><%= error %></li>
      <% }); %>
    </ul>
  </div>
  <% } %>

  <form action="/collections/create" method="POST" id="createCollectionForm">
    <div class="form-group">
      <label for="title">Title <span class="required">*</span></label>
      <input type="text" id="title" name="title" class="form-control <%= errors && errors.some(e => e.includes('Title')) ? 'error' : '' %>" value="<%= formData.title || '' %>" maxlength="150" required>
      <div class="character-count">
        <span id="titleCount">0</span>/150 characters
      </div>
    </div>

    <div class="form-group">
      <label for="description">Description</label>
      <textarea id="description" name="description" class="form-control textarea"><%= formData.description || '' %></textarea>
      <div class="form-help">Describe what this collection is about</div>
    </div>

    <div class="form-group">
      <label for="stories">Add Stories</label>
      <select id="stories" name="stories[]" class="form-control" multiple="multiple">
        <% stories.forEach(function(story) { %>
        <option value="<%= story.id %>" <%= selectedStories.includes(story.id) ? 'selected' : '' %>>
          <%= story.username %>/<%= story.vanity %>
        </option>
        <% }); %>
      </select>
      <div class="form-help">Select stories to include in this collection</div>
    </div>

    <div class="button-group">
      <button type="submit" class="btn btn-primary">Create Collection</button>
      <a href="/users/" class="btn btn-secondary">Cancel</a>
    </div>
  </form>
</div>

<script>
  $(document).ready(function() {
    // Initialize Select2
    $('#stories').select2({
      placeholder: "Select stories...",
      allowClear: true,
      width: '100%'
    });

    // Character counter initialization
    function updateCharacterCount(inputId, countId, maxLength) {
      const input = document.getElementById(inputId);
      const counter = document.getElementById(countId);

      function updateCount() {
        const length = input.value.length;
        counter.textContent = length;

        if (length > maxLength * 0.9) {
          counter.style.color = '#e74c3c';
        } else if (length > maxLength * 0.7) {
          counter.style.color = '#f39c12';
        } else {
          counter.style.color = '#666';
        }
      }

      input.addEventListener('input', updateCount);
      updateCount(); // Initial update
    }

    updateCharacterCount('title', 'titleCount', 150);
  });
</script>